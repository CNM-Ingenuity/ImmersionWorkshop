<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Part 4 - Create Loopback API - Blockchain Immersion Workshop</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Part 4 - Create Loopback API";
    var mkdocs_page_input_path = "loopback.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Blockchain Immersion Workshop</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Use Case Walkthrough</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../immunichain-home/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../immunichain/">Part 1</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">VSCode Lab</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../vscode-home/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../vscode-part1/">Part 1 - Create Smart Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../vscode-part2/">Part 2 - Commercial Paper</a>
                </li>
                <li class="">
                    
    <a class="" href="../xchaincode/">Part 3 - Cross Chaincode and Debug</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Part 4 - Create Loopback API</a>
    <ul class="subnav">
            
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">IBM Blockchain Platform Connect-a-thon Lab</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../connect-home/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../connect-part1/">Part 1</a>
                </li>
                <li class="">
                    
    <a class="" href="../connect-part2/">Part 2</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">IBM Blockchain Platform for Multicloud on Linux on Z Lab</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ibpconsole/">Part 1 - Create a Blockchain Network</a>
                </li>
                <li class="">
                    
    <a class="" href="../ibpdeploy.md">Part 2 - Deploy Smart Contract</a>
                </li>
                <li class="">
                    
    <a class="" href="../cicd.md">Part 3 - CICD</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../references/">Additional Resources</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Blockchain Immersion Workshop</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>VSCode Lab &raquo;</li>
        
      
    
    <li>Part 4 - Create Loopback API</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>In this section, we are going to create a loopback API application for each MagnetoCorp and Digibank. Once we have created these applications, you'll be able to submit transactions and have them be recorded in our blockchain network. </p>
<p><strong>1.</strong> From the CLI application, open a new tab and naviagate to your desktop. Once you are at the desktop, install the loopback npm package. You can find these commands below
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/application$ cd /home/tecadmin/Desktop
tecadmin@ubuntubase:~/Desktop$ npm install -g @loopback/cli
</code></pre>
<p><strong>2.</strong> Once you have the loopback installed, go ahead and follow the series of commands and prompts below. I'll explain these after we have completed this.
::</p>
<pre><code>    ----- Create Our App -----

tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: digibank
? Project description: loopback application for digibank
? Project root directory: digibank
? Application class name: DigibankApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable --- Press enter to enable all of these! ---
prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
   create .eslintignore
   create .eslintrc.js
   create .mocharc.json
   create .npmrc
   create .prettierignore
   create .prettierrc
   create DEVELOPING.md
   create README.md
   create index.ts
   create package.json
   create tsconfig.json
   create .vscode/settings.json
   create .vscode/tasks.json
   create .gitignore
   create .dockerignore
   create Dockerfile
   create index.js
   create public/index.html
   create src/application.ts
   create src/index.ts
   create src/migrate.ts
   create src/sequence.ts
   create src/__tests__/README.md
   create src/controllers/README.md
   create src/controllers/index.ts
   create src/controllers/ping.controller.ts
   create src/datasources/README.md
   create src/models/README.md
   create src/repositories/README.md
   create src/__tests__/acceptance/home-page.acceptance.ts
   create src/__tests__/acceptance/ping.controller.acceptance.ts
   create src/__tests__/acceptance/test-helper.ts
*
*

added 546 packages from 1480 contributors and audited 4133 packages in 14.495s
found 3 vulnerabilities (1 low, 2 moderate)
  run `npm audit fix` to fix them, or `npm audit` for details

Application digibank was created in digibank.

----- Create Models for our Buy and Redeem Transactions -----

tecadmin@ubuntubase:~/Desktop$ cd digibank/
tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: Buy
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Buy
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: currentOwner
? Property type: string
? Is currentOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: newOwner
? Property type: string
? Is newOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: price
? Property type: string
? Is price the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: purchaseDateTime
? Property type: string
? Is purchaseDateTime the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: --- Press Enter! ---
   create src/models/buy.model.ts
   update src/models/index.ts

Model Buy was created in src/models/

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: Redeem
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Redeem
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: redeemingOwner
? Property type: string
? Is redeemingOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: redeemDateTime
? Property type: string
? Is redeemDateTime the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Redeem
Enter an empty property name when done

? Enter the property name: --- Press Enter! ---
   create src/models/redeem.model.ts
   update src/models/index.ts

Model Redeem was created in src/models/

    ----- Create a Datasource -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only): 
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/

    ----- Create a Repository -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Buy, Redeem
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for Buy: id
? Please enter the name of the ID property for Redeem: id
   create src/repositories/buy.repository.ts
   create src/repositories/redeem.repository.ts
   update src/repositories/index.ts
   update src/repositories/index.ts

Repositories BuyRepository,RedeemRepository was created in src/repositories/

----- Create a Controller for both the Buy and Redeem Transaction -----

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Buy
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Buy
? What is the name of your CRUD repository? BuyRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /buys
  create src/controllers/buy.controller.ts
  update src/controllers/index.ts

Controller Buy was created in src/controllers/

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Redeem
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Redeem
? What is the name of your CRUD repository? RedeemRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /redeems
   create src/controllers/redeem.controller.ts
   update src/controllers/index.ts

Controller Redeem was created in src/controllers/
</code></pre>
<p>What you just did above is basically create the bones to our loopback API application. We needed to create our app, model, datasource, repository and controller to actually create our application. Below is a breakdown of each thing we created</p>
<p><strong>App:</strong>
::</p>
<pre><code>The LoopBack 4 CLI toolkit comes with templates that generate whole applications, as well as artifacts (for example, controllers, models, and repositories) for existing applications.

tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: digibank
? Project description: loopback application for digibank
? Project root directory: digibank
? Application class name: DigibankApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable --- Press enter to enable all of these! ---
prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
</code></pre>
<p><strong>Model:</strong>
::</p>
<pre><code>Now we can begin working on the representation of our data for use with LoopBack 4, which needs to aglin with what is in our . To that end, we’re going to create an issue and buy model that can represent instances of a task for our papercontract. A model describes business domain objects and defines a list of properties with name, type, and other constraints. Models are used for data exchange on the wire or between different systems.

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 model
? Model class name: Buy
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Buy
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

* More data fields

create src/models/buy.model.ts
update src/models/index.ts

Model Buy was created in src/models/
</code></pre>
<p><strong>Datasource:</strong>
::</p>
<pre><code>Datasources are LoopBack’s way of connecting to various sources of data, such as databases, APIs, message queues and more. In LoopBack 4, datasources can be represented as strongly-typed objects and freely made available for injection throughout the application. Typically, in LoopBack 4, datasources are used in conjunction with Repositories to provide access to data.

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only):
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/
</code></pre>
<p><strong>Repositories:</strong>
::</p>
<pre><code>A Repository represents a specialized Service interface that provides strong-typed data access (for example, CRUD) operations of a domain model against the underlying database or service.

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Buy, Redeem
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for Buy: id
? Please enter the name of the ID property for Redeem: id
   create src/repositories/buy.repository.ts
   create src/repositories/redeem.repository.ts
   update src/repositories/index.ts
   update src/repositories/index.ts
</code></pre>
<p><strong>Controller:</strong>
::</p>
<pre><code>In LoopBack 4, controllers handle the request-response lifecycle for your API. Each function on a controller can be addressed individually to handle an incoming request (like a POST request to /todos), to perform business logic, and to return a response.

tecadmin@ubuntubase:~/Desktop/digibank$ lb4 controller
? Controller class name: Buy
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Buy
? What is the name of your CRUD repository? BuyRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /buys
  create src/controllers/buy.controller.ts
  update src/controllers/index.ts

Controller Buy was created in src/controllers/
</code></pre>
<p>You can find out more information and great tutorials as to how to build your own loopback API application here: https://loopback.io/doc/en/lb4/index.html</p>
<p><strong>3.</strong> Within VSCode, go to the <code>Edititor Perspective</code> and do <code>File -&gt; Add Folder to Workplace</code> and navigate to the <code>digibank</code> folder that we just created within the <code>Desktop</code> folder. Go ahead and open that folder in VScode.</p>
<p><strong>4.</strong> Now within VSCode, right click on <code>digibank</code> - the folder you just opened in VSCode. Once you right click, select <code>New Folder</code> and name it <code>data</code>. Really mysterious right? </p>
<p><strong>5.</strong> On the newly created folder, <code>data</code>, right click on that folder and select <code>New File</code> and name that file <code>db.json</code>. Within that new file, add in this text below
::</p>
<pre><code>{
  "ids": {
    "Todo": 5
  },
  "models": {
    "Todo": {
      "1": "{\"title\":\"Take over the galaxy\",\"desc\":\"MWAHAHAHAHAHAHAHAHAHAHAHAHAMWAHAHAHAHAHAHAHAHAHAHAHAHA\",\"id\":1}",
      "2": "{\"title\":\"destroy alderaan\",\"desc\":\"Make sure there are no survivors left!\",\"id\":2}",
      "3": "{\"title\":\"terrorize senate\",\"desc\":\"Tell them they're getting a budget cut.\",\"id\":3}",
      "4": "{\"title\":\"crush rebel scum\",\"desc\":\"Every.Last.One.\",\"id\":4}"
    }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> This file, db.json, contains an example database.</p>
<p><strong>6.</strong> Within the <code>digibank</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>digibank -&gt; src -&gt; repositories
</code></pre>
<p>You should see 4 files in there: <code>README.md</code>, <code>buy.respistory.ts</code>, <code>redeem.respostory.ts</code>, and <code>index.ts</code></p>
<p><strong>7.</strong> Within the <code>buy.respitory.ts</code> file, add <code>//</code> on line 8. Look below as to what to do
::</p>
<pre><code>typeof Buy.prototype.id

--- CHANGE TO ---

// typeof Buy.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>8.</strong> Do the same thing for <code>redeem.respository.ts</code> on line 8
::</p>
<pre><code>typeof Redeem.prototype.id

--- CHANGE TO ---

// typeof Redeem.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>9.</strong> Within the <code>digibank</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>digibank -&gt; src -&gt; controllers
</code></pre>
<p>You should see 5 files in there: <code>README.md</code>, <code>buy.controller.ts</code>, <code>redeem.controller.ts</code>, <code>ping.controller.ts</code>, and <code>index.ts</code></p>
<p><strong>10.</strong> Within the <code>buy.controller.ts</code> file, delete all of its contents and paste in the code that is below
::</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Buy } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class BuyController {
  constructor() { }

  @post('/buy', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Buy } } },
      },
    },
  })
  async createBuy(@requestBody() requestBody: Buy): Promise&lt;Buy&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)
    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let buy = new Buy({
        issuer: errString, paperNumber: errString, currentOwner: errString, newOwner: errString,
        price: errString, purchaseDateTime: errString
      });
      return buy;
    }
    console.log('newtork obj: ')
   console.log(networkObj)
   // dateStr = dateStr.toDateString();
    let dataForBuy = {
      function: 'buy',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      currentOwner: requestBody.currentOwner,
      newOwner: requestBody.newOwner,
      price: requestBody.price,
      purchaseDateTime: requestBody.purchaseDateTime,
      contract: networkObj.contract
    };

    var resultAsBuffer = await blockchainClient.buy(dataForBuy);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
    let buy = new Buy({
      issuer: result.issuer, paperNumber: result.paperNumber, currentOwner: result.currentOwner,
      newOwner: result.currentOwner, price: result.price, purchaseDateTime: result.purchaseDateTime
    });
    return buy;
  }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong> Below is a breakdown of this file above</p>
<p>Below, we are pulling in the <code>buy</code> model that we created when we created our loopback API application
::</p>
<pre><code>import { Buy } from '../models';
</code></pre>
<p>Below, we are only specifying a <code>post</code> API call. A post call, adds data, in this case a transaction against our blockchain network, to our ledgers
::</p>
<pre><code>@post('/buy', {
    responses: {
      '200': {
</code></pre>
<p>Below, we are actually submitting a transaction, a <code>buy</code> transaction. This transaction is looking for all the data fields we created in our <code>buy</code> model file. If all goes well, we will successfully <code>buy</code> a commercialpaper. 
::</p>
<pre><code>  async createBuy(@requestBody() requestBody: Buy): Promise&lt;Buy&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)
    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let buy = new Buy({
        issuer: errString, paperNumber: errString, currentOwner: errString, newOwner: errString,
        price: errString, purchaseDateTime: errString
      });
      return buy;
    }
</code></pre>
<p><strong>11.</strong> Within the <code>redeem.controller.ts</code> file, delete all of its contents and paste in what is below
::</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Redeem } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class RedeemController {
  constructor() { }

  @post('/redeem', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Redeem } } },
      },
    },
  })
  async createIssue(@requestBody() requestBody: Redeem): Promise&lt;Redeem&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)

    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let redeem = new Redeem({
        issuer: errString, paperNumber: errString, redeemingOwner: errString,
        redeemDateTime: errString
     });
     return redeem;
    }
    console.log('newtork obj: ')
    console.log(networkObj)

    let dataForRedeem = {
      function: 'redeem',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      redeemingOwner: requestBody.redeemingOwner,
      redeemDateTime: requestBody.redeemDateTime,
      contract: networkObj.contract
    };

    var resultAsBuffer = await blockchainClient.redeem(dataForRedeem);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
   let issue = new Redeem({
     issuer: result.issuer, paperNumber: result.paperNumber, redeemingOwner: result.redeemingOwner,
     redeemDateTime: result.redeemDateTime
   });
   return issue;
 }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>12.</strong> Within VSCode, right click on the <code>src</code> folder (within the <code>digibank</code> folder) and select <code>New File</code>. Go ahead and name this file <code>blockchainClient.ts</code></p>
<p><strong>13.</strong> Within our new <code>blockchainClient.ts</code> file, paste in this code below
::</p>
<pre><code>const yaml = require('js-yaml');
const { FileSystemWallet, Gateway } = require('fabric-network');
const fs = require('fs');

// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/identity/user/balaji/wallet');


export module BlockChainModule {

  export class BlockchainClient {
    async connectToNetwork() {

      const gateway = new Gateway();

      try {
        console.log('connecting to Fabric network...')


       const identityLabel = 'Admin@org1.example.com';
       let connectionProfile = yaml.safeLoad(fs.readFileSync('./networkConnection.yaml', 'utf8'));

       let connectionOptions = {
         identity: identityLabel,
         wallet: wallet,
         discovery: {
           asLocalhost: true
         }
       };

       // Connect to gateway using network.yaml file and our certificates in _idwallet directory
       await gateway.connect(connectionProfile, connectionOptions);

       console.log('Connected to Fabric gateway.');

       // Connect to our local fabric
       const network = await gateway.getNetwork('mychannel');

       console.log('Connected to mychannel. ');

       // Get the contract we have installed on the peer
       const contract = await network.getContract('papercontract');


       let networkObj = {
         contract: contract,
         network: network
       };

        return networkObj;

    } catch (error) {
       console.log(`Error processing transaction. ${error}`);
       console.log(error.stack);
     } finally {
       console.log('Done connecting to network.');
       // gateway.disconnect();
      }

    }

   async redeem(args: any) {

      console.log('args for redeem: ')
      console.log(args)

      let response = await args.contract.submitTransaction(args.function,
        args.issuer, args.paperNumber, args.redeemingOwner, args.redeemDateTime
      );

      return response;
    }

    async buy(args: any) {

      console.log('args for buy: ')
      console.log(args)

      let response = await args.contract.submitTransaction(args.function,
        args.issuer, args.paperNumber, args.currentOwner, args.newOwner,
        args.price, args.purchaseDateTime
      );

      return response;

    }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> Below is a breakdown of our <code>blockchainClient.ts</code> file</p>
<p>Below, you'll see that we are specifing where our user's credientials are located to validate that our user can actually submit a transaction. 
::</p>
<pre><code>// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/identity/user/balaji/wallet');
</code></pre>
<p>Below, we are saying that within the <code>balaji/wallet</code> folder we are using <code>Admin@org1.example.com</code> as our user. Also, we are saying that our connection profile is <code>networkConnection.yaml</code> located one directory back. We will copy the connection profile in the next section.
::</p>
<pre><code>const identityLabel = 'Admin@org1.example.com';
let connectionProfile = yaml.safeLoad(fs.readFileSync('./networkConnection.yaml', 'utf8'));
</code></pre>
<p>Below, we are connection to our channel, called <code>mychannel</code>, and also using our smart contract, called <code>papercontract</code>
::</p>
<pre><code>// Connect to our local fabric
const network = await gateway.getNetwork('mychannel');

console.log('Connected to mychannel. ');

// Get the contract we have installed on the peer
const contract = await network.getContract('papercontract');
</code></pre>
<p>Below, we are actually submitting our <code>redeem</code> transaction. There is a very similar transaction, but for <code>buy</code>. This will use our <code>redeem</code> controller as a basis for our actual arguments (args). 
::</p>
<pre><code>async redeem(args: any) {

console.log('args for redeem: ')
console.log(args)

let response = await args.contract.submitTransaction(args.function,
    args.issuer, args.paperNumber, args.redeemingOwner, args.redeemDateTime
);

    return response;
}
</code></pre>
<p><strong>14.</strong> Now, we need to copy our <code>networkConnection.yaml</code> file over from <code>digibank</code> in our <code>fabric-samples-cp</code> folder and place it into our <code>digibank</code> folder. You can execute the command below, from our CLI application, as to how to copy 
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ cp /home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/gateway/networkConnection.yaml .
</code></pre>
<p><strong>15.</strong> We need to modify our <code>package.json</code> file to include the <code>fabric-network</code> module. Within our <code>digibank</code> folder, find the <code>package.json</code> file and add in the following text below on <code>line 58</code>
::</p>
<pre><code>"fabric-network": "~1.4.1"
</code></pre>
<p>So now our <code>dependecies</code> look like this
::</p>
<p>"dependencies": {
    "@loopback/boot": "^1.4.0",
    "@loopback/context": "^1.19.0",
    "@loopback/core": "^1.8.1",
    "@loopback/openapi-v3": "^1.6.1",
    "@loopback/repository": "^1.6.1",
    "@loopback/rest": "^1.15.0",
    "@loopback/rest-explorer": "^1.2.1",
    "@loopback/service-proxy": "^1.2.1",
    "fabric-network": "~1.4.1"</p>
<p><strong>Do not forget to add a comma (,) after the "@loopback/service-proxy": "^1.2.1" dependency</strong></p>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>16.</strong> Now we can delete the <code>node_modules</code> and <code>package-lock.json</code> file so that it will pick up the <code>fabric-network</code> package on we install again. To do this, within VSCode, right click on <code>node_modules</code> and select <code>Delete</code>. Do the same for <code>node_modules</code>. If it asks you to confirm this, select <code>Move to Trash</code>.</p>
<p><strong>17.</strong> Back in our CLI application, do an <code>npm install</code> within the <code>digibank</code> folder
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm install
*
*
*
added 748 packages from 1578 contributors and audited 4980 packages in 45.757s
found 3 vulnerabilities (1 low, 2 moderate)
</code></pre>
<p><strong>18.</strong> Then you can do an <code>npm build</code> as well from the same folder
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm run build

&gt; digibank@1.0.0 build /home/tecadmin/Desktop/digibank
&gt; lb-tsc es2017 --outDir dist
</code></pre>
<p><strong>19.</strong> We will hold off on starting the server until we have built the MagnetoCorp loopback application as well. </p>
<p><strong>20.</strong> Speaking of MagnetoCorp, let's build their loopback API application. It will be very similar to how we built DigiBank's. </p>
<p><strong>21.</strong> Go ahead and follow the series of commands and prompts below to create MagnetoCorp's loopback application. I'll explain these after we have completed this.
::</p>
<pre><code>    ----- Create Our App -----

tecadmin@ubuntubase:~/Desktop/digibank$ cd ..
tecadmin@ubuntubase:~/Desktop$ lb4 app
? Project name: magnetocorp-commercialpaper
? Project description: loopback application for magnetocorp-commercialpaper
? Project root directory: magnetocorp-commercialpaper
? Application class name: MagnetocorpCommercialpaperApplication
? Select features to enable in the project (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Enable eslint, Enable --- Press enter to enable all of these! ---
prettier, Enable mocha, Enable loopbackBuild, Enable vscode, Enable docker, Enable repositories, Enable services
   create .eslintignore
   create .eslintrc.js
   create .mocharc.json
   create .npmrc
   create .prettierignore
   create .prettierrc
   create DEVELOPING.md
   create README.md
   create index.ts
   create package.json
   create tsconfig.json
   create .vscode/settings.json
   create .vscode/tasks.json
   create .gitignore
   create .dockerignore
   create Dockerfile
   create index.js
   create public/index.html
   create src/application.ts
   create src/index.ts
   create src/migrate.ts
   create src/sequence.ts
   create src/__tests__/README.md
   create src/controllers/README.md
   create src/controllers/index.ts
   create src/controllers/ping.controller.ts
   create src/datasources/README.md
   create src/models/README.md
   create src/repositories/README.md
   create src/__tests__/acceptance/home-page.acceptance.ts
   create src/__tests__/acceptance/ping.controller.acceptance.ts
   create src/__tests__/acceptance/test-helper.ts
*
*

added 546 packages from 1480 contributors and audited 4133 packages in 14.495s
found 3 vulnerabilities (1 low, 2 moderate)
  run `npm audit fix` to fix them, or `npm audit` for details

Application magnetocorp-commercialpaper was created in magnetocorp-commercialpaper.

----- Create Models for our Issue Transaction -----

tecadmin@ubuntubase:~/Desktop$ cd magnetocorp-commercialpaper/
tecadmin@ubuntubase:~/Desktop/magnetocorp-commercialpaper$ lb4 model
? Model class name: Issue
? Please select the model base class Entity (A persisted model with an ID)
? Allow additional (free-form) properties? No
Let's add a property to Issue
Enter an empty property name when done

? Enter the property name: issuer
? Property type: string
? Is issuer the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: paperNumber
? Property type: string
? Is paperNumber the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: issueDateTime
? Property type: string
? Is currentOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: maturityDateTime
? Property type: string
? Is newOwner the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Issue
Enter an empty property name when done

? Enter the property name: faceValue
? Property type: string
? Is price the ID property? No
? Is it required?: Yes
? Default value [leave blank for none]:

Let's add another property to Buy
Enter an empty property name when done

? Enter the property name: --- Press Enter! ---
   create src/models/issue.model.ts
   update src/models/index.ts

Model Buy was created in src/models/

    ----- Create a Datasource -----

tecadmin@ubuntubase:~/Desktop/magnetocorp-commercialpaper$ lb4 datasource
? Datasource name: db
? Select the connector for db: In-memory db (supported by StrongLoop)
? window.localStorage key to use for persistence (browser only): 
? Full path to file for persistence (server only): ./data/db.json
   create src/datasources/db.datasource.json
   create src/datasources/db.datasource.ts
   update src/datasources/index.ts

Datasource db was created in src/datasources/

    ----- Create a Repository -----

tecadmin@ubuntubase:~/Desktop/magnetocorp-commercialpaper$ lb4 repository
? Please select the datasource DbDatasource
? Select the model(s) you want to generate a repository (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Issue
? Please select the repository base class DefaultCrudRepository (Legacy juggler bridge)
? Please enter the name of the ID property for Issue: id
   create src/repositories/issue.repository.ts
   update src/repositories/index.ts

Repositories IssueRepository was created in src/repositories/

----- Create a Controller for the Issue Transaction -----

tecadmin@ubuntubase:~/Desktop/magnetocorp-commercialpaper$ lb4 controller
? Controller class name: Issue
? What kind of controller would you like to generate? REST Controller with CRUD functions
? What is the name of the model to use with this CRUD repository? Issue
? What is the name of your CRUD repository? IssueRepository
? What is the type of your ID? string
? What is the base HTTP path name of the CRUD operations? /issues
  create src/controllers/issue.controller.ts
  update src/controllers/index.ts

Controller Issue was created in src/controllers/
</code></pre>
<p>You had to do the same thing for MagnetoCorp, as you did for DigiBank, and their loopback API application. </p>
<p><strong>22.</strong> Within VSCode, go to the <code>Edititor Perspective</code> and do <code>File -&gt; Add Folder to Workplace</code> and navigate to the <code>magnetocorp-commercialpaper</code> folder that we just created within the <code>Desktop</code> folder. Go ahead and open that folder in VScode.</p>
<p><strong>23.</strong> Now within VSCode, right click on <code>magnetocorp-commercialpaper</code> - the folder you just opened in VSCode. Once you right click, select <code>New Folder</code> and name it <code>data</code>. Really mysterious right? </p>
<p><strong>24.</strong> On the newly created folder, <code>data</code>, right click on that folder and select <code>New File</code> and name that file <code>db.json</code>. Within that new file, add in this text below
::</p>
<pre><code>{
  "ids": {
    "Todo": 5
  },
  "models": {
    "Todo": {
      "1": "{\"title\":\"Take over the galaxy\",\"desc\":\"MWAHAHAHAHAHAHAHAHAHAHAHAHAMWAHAHAHAHAHAHAHAHAHAHAHAHA\",\"id\":1}",
      "2": "{\"title\":\"destroy alderaan\",\"desc\":\"Make sure there are no survivors left!\",\"id\":2}",
      "3": "{\"title\":\"terrorize senate\",\"desc\":\"Tell them they're getting a budget cut.\",\"id\":3}",
      "4": "{\"title\":\"crush rebel scum\",\"desc\":\"Every.Last.One.\",\"id\":4}"
    }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong> This file, db.json, contains an example database.</p>
<p><strong>25.</strong> Within the <code>magnetocorp-commercialpaper</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>magnetocorp-commercialpaper -&gt; src -&gt; repositories
</code></pre>
<p>You should see 3 files in there: <code>README.md</code>, <code>issue.respistory.ts</code>, and <code>index.ts</code></p>
<p><strong>26.</strong> Within the <code>issue.respitory.ts</code> file, add <code>//</code> on line 8. Look below as to what to do
::</p>
<pre><code>typeof Issue.prototype.id

--- CHANGE TO ---

// typeof Issue.prototype.id
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>27.</strong> Within the <code>magnetocorp-commercialpaper</code> folder in VSCode, navigate to the following folder
::</p>
<pre><code>magnetocorp-commercialpaper -&gt; src -&gt; controllers
</code></pre>
<p>You should see 4 files in there: <code>README.md</code>, <code>issue.controller.ts</code>, <code>ping.controller.ts</code>, and <code>index.ts</code></p>
<p><strong>28.</strong> Within the <code>issue.controller.ts</code> file, delete all of its contents and paste in the code that is below
::</p>
<pre><code>// Copyright IBM Corp. 2017,2018. All Rights Reserved.
// Node module: @loopback/example-todo
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT

import {
  del,
  get,
  getFilterSchemaFor,
  param,
  patch,
  post,
  put,
  requestBody,
} from '@loopback/rest';
import { Issue } from '../models';

import { BlockChainModule } from '../blockchainClient';

let blockchainClient = new BlockChainModule.BlockchainClient();

export class IssueController {
  constructor() { }

  @post('/issue', {
    responses: {
      '200': {
        description: 'Todo model instance',
        content: { 'application/json': { schema: { 'x-ts-type': Issue } } },
      },
    },
  })
  async createIssue(@requestBody() requestBody: Issue): Promise&lt;Issue&gt; {
    console.log('Buy, requestBody: ')
    console.log(requestBody)


    let networkObj = await blockchainClient.connectToNetwork();
    if (!networkObj) {
      let errString = 'Error connecting to network';
      let issue = new Issue({ issuer: errString, paperNumber: errString, issueDateTime: errString, maturityDateTime: errString });
      return issue;
    }
    console.log('newtork obj: ')
    console.log(networkObj)

    let dataForIssue = {
      function: 'issue',
      issuer: requestBody.issuer,
      paperNumber: requestBody.paperNumber,
      issueDateTime: requestBody.issueDateTime,
      maturityDateTime: requestBody.maturityDateTime,
      faceValue: requestBody.faceValue,
      contract: networkObj.contract
    };

    var resultAsBuffer = await blockchainClient.issue(dataForIssue);

    console.log('result from blockchainClient.submitTransaction in controller: ')
    console.log('result from blockchainClient.submitTransaction in controller: ')
    let result = JSON.parse(Buffer.from(JSON.parse(resultAsBuffer)).toString())
    let issue = new Issue({
      issuer: result.issuer, paperNumber: result.paperNumber, issueDateTime: result.issueDateTime,
      maturityDateTime: result.maturityDateTime
    });
    return issue;
  }

}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>29.</strong> Within VSCode, right click on the <code>src</code> folder (within the <code>magnetocorp-commercial</code> folder) and select <code>New File</code>. Go ahead and name this file <code>blockchainClient.ts</code></p>
<p><strong>30.</strong> Within our new <code>blockchainClient.ts</code> file, paste in this code below
::</p>
<pre><code>const yaml = require('js-yaml');
const { FileSystemWallet, Gateway } = require('fabric-network');
const fs = require('fs');

// A wallet stores a collection of identities for use
const wallet = new FileSystemWallet('/home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/magnetocorp/identity/user/isabella/wallet');


export module BlockChainModule {

  export class BlockchainClient {
    async connectToNetwork() {

      const gateway = new Gateway();

      try {
        console.log('connecting to Fabric network...')


       const identityLabel = 'User1@org1.example.com';
       let connectionProfile = yaml.safeLoad(fs.readFileSync('./networkConnection.yaml', 'utf8'));

       let connectionOptions = {
         identity: identityLabel,
         wallet: wallet,
         discovery: {
           asLocalhost: true
         }
       };

       // Connect to gateway using network.yaml file and our certificates in _idwallet directory
       await gateway.connect(connectionProfile, connectionOptions);

       console.log('Connected to Fabric gateway.');

       // Connect to our local fabric
       const network = await gateway.getNetwork('mychannel');

       console.log('Connected to mychannel. ');

       // Get the contract we have installed on the peer
       const contract = await network.getContract('papercontract');


       let networkObj = {
         contract: contract,
         network: network
       };

        return networkObj;

    } catch (error) {
       console.log(`Error processing transaction. ${error}`);
       console.log(error.stack);
     } finally {
       console.log('Done connecting to network.');
       // gateway.disconnect();
      }

    }

    async issue(args: any) {

      console.log('args for issue: ')
      console.log(args)

      let response = await args.contract.submitTransaction(args.function,
        args.issuer, args.paperNumber, args.issueDateTime, args.maturityDateTime,
        args.faceValue
      );

      return response;

    }
  }
}
</code></pre>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>31.</strong> Now, we need to copy our <code>networkConnection.yaml</code> file over from <code>magnetocorp</code> in our <code>fabric-samples-cp</code> folder and place it into our <code>magnetocorp-commercial</code> folder. You can execute the command below, from our CLI application, as to how to copy 
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp-commercial$ cp /home/tecadmin/Desktop/fabric-samples-cp/commercial-paper/organization/magnetocorp/gateway/networkConnection.yaml .
</code></pre>
<p><strong>32.</strong> Within our <code>magnetocorp-commercial</code> folder in VSCode, find the <code>index.js</code> file. In here there is a port number we need to change. Since <code>digibank-commercialpaper</code> is occupying port `3000<code>, we should make</code>magnetocorp-commercial<code>occupy port</code>3001<code>. You can find the port number within the</code>index.js`` file on line 9. Look below at to what to do
::</p>
<pre><code>port: +process.env.PORT || 3000,

--- CHANGE TO ---

port: +process.env.PORT || 3001,
</code></pre>
<p><strong>33.</strong> We need to modify our <code>package.json</code> file to include the <code>fabric-network</code> module. Within our <code>magnetocorp-commercial</code> folder, find the <code>package.json</code> file and add in the following text below on <code>line 58</code>
::</p>
<pre><code>"fabric-network": "~1.4.1"
</code></pre>
<p>So now our <code>dependecies</code> look like this
::</p>
<p>"dependencies": {
    "@loopback/boot": "^1.4.0",
    "@loopback/context": "^1.19.0",
    "@loopback/core": "^1.8.1",
    "@loopback/openapi-v3": "^1.6.1",
    "@loopback/repository": "^1.6.1",
    "@loopback/rest": "^1.15.0",
    "@loopback/rest-explorer": "^1.2.1",
    "@loopback/service-proxy": "^1.2.1",
    "fabric-network": "~1.4.1"</p>
<p><strong>Do not forget to add a comma (,) after the "@loopback/service-proxy": "^1.2.1" dependency</strong></p>
<p><strong>Go ahead and save this file!</strong></p>
<p><strong>34.</strong> Now we can delete the <code>node_modules</code> and <code>package-lock.json</code> file so that it will pick up the <code>fabric-network</code> package on we install again. To do this, within VSCode, right click on <code>node_modules</code> and select <code>Delete</code>. Do the same for <code>node_modules</code>. If it asks you to confirm this, select <code>Move to Trash</code>.</p>
<p><strong>35.</strong> Back in our CLI application, do an <code>npm install</code> within the <code>digibank</code> folder
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp-commercial$ npm install
*
*
*
added 748 packages from 1578 contributors and audited 4980 packages in 45.757s
found 3 vulnerabilities (1 low, 2 moderate)
</code></pre>
<p><strong>36.</strong> Then you can do an <code>npm build</code> as well from the same folder
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp-commercial$ npm run build

&gt; magnetocorp-commercialpaper@1.0.0 build /home/tecadmin/Desktop/digibank
&gt; lb-tsc es2017 --outDir dist
</code></pre>
<p><strong>37.</strong> Now, we can start both loopback applications. Let's first go start DigiBank's. To do this, find go to your CLI application - where you generate the <code>digibank</code> folder. Then run the command below
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/digibank$ npm start

&gt; digibank@1.0.0 prestart /home/tecadmin/Desktop/digibank
&gt; npm run build


&gt; digibank@1.0.0 build /home/tecadmin/Desktop/digibank
&gt; lb-tsc es2017 --outDir dist


&gt; digibank@1.0.0 start /home/tecadmin/Desktop/digibank
&gt; node .

Server is running at http://[::1]:3000
Try http://[::1]:3000/ping
</code></pre>
<p><strong>38.</strong> Then go to your <code>magnetocorp-commercialpaper</code> CLI application and do the same command
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/magnetocorp-commercialpaper$ npm start

&gt; magnetocorp-commercialpaper@1.0.0 prestart /home/tecadmin/Desktop/magnetocorp-commercialpaper
&gt; npm run build


&gt; magnetocorp-commercialpaper@1.0.0 build /home/tecadmin/Desktop/magnetocorp-commercialpaper
&gt; lb-tsc es2017 --outDir dist


&gt; magnetocorp-commercialpaper@1.0.0 start /home/tecadmin/Desktop/magnetocorp-commercialpaper
&gt; node .

Server is running at http://[::1]:3001
Try http://[::1]:3001/ping
</code></pre>
<p><strong>39.</strong> Proceed to go to <code>DigiBank's</code> loopback application by going to <code>http://[::1]:3000</code></p>
<p><img alt="image" src="../vscode-images/2-6-39.png" /></p>
<p><strong>40.</strong> Do the same, but this time for MagnetoCorp. You can go to <code>http://[::1]:3001</code>. It should look the same as DigiBank, but says `MagnetoCorp`` instead. </p>
<p><strong>41.</strong> You can move forward <strong>with both loopback applications</strong> by clicking on the <code>/explorer</code> link toward the bottom</p>
<p><strong>42.</strong> Within the <code>MagnetoCorp</code> loopback UI (<code>port 3001</code>), go ahead and toggle on the <code>Issue</code> controller. Then click on <code>Try it Out</code>.</p>
<p><img alt="image" src="../vscode-images/2-6-42.png" /></p>
<p><strong>43.</strong> Then paste in the code below to issue a new paper in the white space
::</p>
<pre><code>{
  "issuer": "MagnetoCorp",
  "paperNumber": "00003",
  "issueDateTime": "2020-05-31",
  "maturityDateTime": "2020-11-30",
  "faceValue": "5000000"
}
</code></pre>
<p><strong>44.</strong> Once you have the new paper in there, go ahead and click on the blue <code>Execute</code> button below</p>
<p><strong>45.</strong> Then you will see the output of our <code>issue</code> transaction</p>
<p><img alt="image" src="../vscode-images/2-6-45.png" /></p>
<p><strong>46.</strong> Within the <code>digibank -&gt; application</code> folder in VSCode, change our <code>getPaper.js</code> trnasaction to look for paper <code>00003</code> on line 68
::</p>
<pre><code>const getPaperResponse = await contract.evaluateTransaction('getPaper', 'MagnetoCorp', '00002');

--- CHANGE TO ---

const getPaperResponse = await contract.evaluateTransaction('getPaper', 'MagnetoCorp', '00003');
</code></pre>
<p><strong>47.</strong> Then do a <code>getPaper.js</code> transaction from our <code>digibank/application</code> tab in our CLI application
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/application$ node getPaper.js
Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper getPaper transaction.
Process getPaper transaction response.
 +--------- Paper Retrieved ---------+ 
 | Paper number: "00003"
 | Paper is owned by: "MagnetoCorp"
 | Paper is currently: "ISSUED"
 | Paper face value: "5000000"
 | Paper is issued by: "MagnetoCorp"
 | Paper issue on: "2020-05-31"
 | Paper matures on: "2020-11-30"
 +-----------------------------------+ 
Transaction complete.
Disconnect from Fabric gateway.
getPaper program complete.
</code></pre>
<p><strong>48.</strong> From the IBM Blockchain Platform extension in VSCode, connect to the <code>DigiBank</code> Fabric Gateway. Then untoggle till you see the <code>buy</code> transaction under our <code>papercontract@0</code> smart contract. Enter the code below - between the brackets - to submit this transaction
::</p>
<pre><code>"MagnetoCorp", "00003", "MagnetoCorp", "DigiBank", "4900000", "2019-07-31"
</code></pre>
<p><strong>49.</strong> Then do another <code>getPaper.js</code> transaction from our CLI application
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/application$ node getPaper.js
Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper getPaper transaction.
Process getPaper transaction response.
 +--------- Paper Retrieved ---------+ 
 | Paper number: "00003"
 | Paper is owned by: "MagnetoCorp"
 | Paper is currently: "TRADING"
 | Paper face value: "5000000"
 | Paper is issued by: "MagnetoCorp"
 | Paper issue on: "2020-05-31"
 | Paper matures on: "2020-11-30"
 +-----------------------------------+ 
Transaction complete.
Disconnect from Fabric gateway.
getPaper program complete.
</code></pre>
<p><strong>50.</strong> Now, let's go to our <code>DigiBank</code> loopback application and do a <code>redeem</code> transaction. To do this, untoggle the <code>Redeem</code> controller and click on <code>Try it out</code></p>
<p><img alt="image" src="../vscode-images/2-6-50.png" /></p>
<p><strong>51.</strong> Then paste in what is below in the white space
::</p>
<pre><code>{
  "issuer": "MagnetoCorp",
  "paperNumber": "00003",
  "redeemingOwner": "DigiBank",
  "redeemDateTime": "2020-11-30"
}
</code></pre>
<p><strong>52.</strong> Once you have that in place, go ahead and click on the blue <code>Execute</code> button. </p>
<p><img alt="image" src="../vscode-images/2-6-52.png" /></p>
<p><strong>53.</strong> To make this paper complete, go ahead and do another <code>getPaper.js</code> transaction from our CLI application
::</p>
<pre><code>tecadmin@ubuntubase:~/Desktop/fabric-samples-cp/commercial-paper/organization/digibank/application$ node getPaper.js
Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper getPaper transaction.
Process getPaper transaction response.
 +--------- Paper Retrieved ---------+ 
 | Paper number: "00003"
 | Paper is owned by: "MagnetoCorp"
 | Paper is currently: "REDEEMED"
 | Paper face value: "5000000"
 | Paper is issued by: "MagnetoCorp"
 | Paper issue on: "2020-05-31"
 | Paper matures on: "2020-11-30"
 +-----------------------------------+ 
Transaction complete.
Disconnect from Fabric gateway.
getPaper program complete.
</code></pre>
<p>Feel free to submit transactions some more through the CLI application, VSCode, or loopback applications. Once you are done, go ahead and clean up the lab station so we can have more fun the labs coming up.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../connect-home/" class="btn btn-neutral float-right" title="Introduction">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../xchaincode/" class="btn btn-neutral" title="Part 3 - Cross Chaincode and Debug"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ibm-blockchain-wsc/ImmersionWorkshop.git" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../xchaincode/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../connect-home/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
